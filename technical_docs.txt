
============================================================
MEHTA V15 - TECHNICAL ARCHITECTURE & N8N INTEGRATION
============================================================

1. CORE FUNCTION LOGIC
------------------------------------------------------------
- Text Chat Submission: 
  The text input bar now triggers 'handleSendMessage', which captures the user query and routes it to an external n8n workflow.

- sendToN8N(query): 
  Packages the user query, recent chat history, and the full content of all uploaded assets (from the local 'vectorStore') into a single POST request. 
  
- Vector Sharing: 
  The 'vectorStore' is shared between the Live Audio session and the Text Chat session. If a user uploads a file, it is immediately available for n8n to reference in its next response.

2. N8N WEBHOOK SPECIFICATION
------------------------------------------------------------
The application expects an n8n webhook response in the following JSON format:
{
  "output": "The text response from the AI architect..."
}

Payload sent to n8n:
{
  "message": "User query string",
  "history": [ { "role": "user", "content": "..." }, ... ],
  "assets": [ { "name": "resume.pdf", "content": "Extracted text data..." } ],
  "timestamp": "ISO-8601 string"
}

3. TOOL CALL DEFINITIONS & IMPLEMENTATION
------------------------------------------------------------
Model ('gemini-2.5-flash-native-audio') invokes these tools in VOICE mode:
A. list_available_assets: Lists filenames/URLs from state.
B. get_document_content: Extracts text from internal res:// URLs.
C. generate_resume_pdf: Synthesis engine (HTML -> Canvas -> PDF).

4. OPTIMIZATION ANALYSIS
------------------------------------------------------------
- Hybrid Logic: Text chat uses n8n for structured logic/external DB lookups, while Voice uses Gemini Live API for low-latency natural interaction.
- Auto-Minimize: To improve UX, the call overlay automatically shrinks to a floating PiP window when a PDF is generated, allowing the user to click the download link immediately.

============================================================
DOCUMENT END
============================================================
